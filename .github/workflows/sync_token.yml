name: Auto Sync token_bd.json from txcpanel/like-api

on:
  schedule:
    - cron: "*/10 * * * *" # ⏱️ Runs every 10 minutes
  workflow_dispatch: # 🖐 Manual trigger from Actions tab

permissions:
  contents: write  # ✅ Allow workflow to push changes

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: 🛠 Checkout your repository
        uses: actions/checkout@v4

      - name: 🌐 Download latest token file from source repo
        run: |
          mkdir -p tokens
          echo "Downloading latest token_bd.json..."
          curl -f -L -o tokens/token_bd.json https://raw.githubusercontent.com/txcpanel/like-api/main/tokens/token_bd.json
          echo "✅ Download completed!"

      - name: 🧠 Check if file changed and push update
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"

          git add tokens/token_bd.json

          if git diff --cached --quiet; then
            echo "⚠️ No changes detected — nothing to commit."
          else
            echo "✅ Changes detected — committing and pushing..."
            git commit -m "Auto-sync token_bd.json from txcpanel/like-api"
            git push
            echo "🚀 Push complete!"
          fi
