name: Auto Sync token_bd.json from txcpanel/like-api

on:
  schedule:
    - cron: "*/10 * * * *" # â±ï¸ Runs every 10 minutes
  workflow_dispatch: # ğŸ– Manual trigger from Actions tab

permissions:
  contents: write  # âœ… Allow workflow to push changes

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›  Checkout your repository
        uses: actions/checkout@v4

      - name: ğŸŒ Download latest token file from source repo
        run: |
          mkdir -p tokens
          echo "Downloading latest token_bd.json..."
          curl -f -L -o tokens/token_bd.json https://raw.githubusercontent.com/txcpanel/like-api/main/tokens/token_bd.json
          echo "âœ… Download completed!"

      - name: ğŸ§  Check if file changed and push update
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"

          git add tokens/token_bd.json

          if git diff --cached --quiet; then
            echo "âš ï¸ No changes detected â€” nothing to commit."
          else
            echo "âœ… Changes detected â€” committing and pushing..."
            git commit -m "Auto-sync token_bd.json from txcpanel/like-api"
            git push
            echo "ğŸš€ Push complete!"
          fi
